---
title: Redis发布订阅
author: Noah
date: 2024/07/08 13:50
categories: 
 - Redis进阶
tags:
 - Redis
 - Redis进阶
---
# Redis发布订阅

[[toc]]

::: tip 什么是发布订阅？:frowning:

Redis 的发布订阅(Pub/Sub) 是消息传递模式之一，它允许消息发送者(发布者)将消息发布到频道(channel)，然后所有订阅了这些频道的接受者(订阅者)会接收到相应的信息。该模式适用于需要实时消息传递的场景，例如聊天系统、实时通知、数据推送等。

:::

## 发布订阅模型

发布订阅分为三个模型板块：

- **发布者(Publisher):** 发送消息到特定频道的客户端。
- **订阅者(Subscriber):** 订阅某个频道以接受发布者发送的消息的客户端。
- **频道(Channel):** 消息传输的通道，发布者将消息发布到特定频道，订阅者收到频道中的消息。

<img src="https://raw.githubusercontent.com/Noah2Y/img/main/blog/20240708141331.jpg" style="zoom: 67%;" />

## 核心数据结构

Redis 发布订阅功能主要依赖以下三种数据结构：

1. **订阅记录表（`pubsub_channels`）**：哈希表（dictionary），键是频道名，值是订阅这个频道的客户端列表。
2. **模式记录表（`pubsub_patterns`）**：链表（list），存储了所有订阅模式的客户端和对应的模式。
3. **客户端结构**：每个客户端有两个字段分别保存它所订阅的频道和模式列表。

## 消息发送机制

在发布订阅系统中，消息的发送过程是异步的，这意味着 PUBLISH 命令的执行不会被消息投递给订阅者的过程阻塞。但是，对于接收到消息的订阅者，消息投递是同步的，即 Redis 会立即将消息传递给订阅者。

## 性能和扩展

Redis 发布订阅是内存级操作，性能非常高，适合小规模、单节点的应用场景。然而，在高并发、多节点、大规模分布式系统中，Redis 的发布订阅模式存在以下几个限制:

- **消息不持久化:** 一点消息发布，如果订阅者未在线，则消息将丢失。这对于需要高可靠性消息传递的场景可能不适用。
- **单节点限制:** Redis 发布订阅的实现基于单节点内存结构，多节点环境下，无法实现跨节点的频道订阅和消息传递。
- **扩展性问题:** 高并发时，单节点的网络 I/O 和内存消耗可能成为瓶颈，需要进行高并发性能优化或者选择其他的消息中间件解决方案。

::: info 其他解决方案:yum:

熟悉消息中间件的同学都知道，针对消息订阅发布功能，市面上很多大厂使用的是`kafka`、`RabbitMQ`、`ActiveMQ`, `RocketMQ等这几种，`redis的订阅发布功能跟这三者相比，相对轻量，针对数据准确和安全性要求没有那么高可以直接使用，适用于小公司。

:::
